<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title></title>
    <script src="../js/vue.js"></script>
    <script src="../js/element-ui.js"></script>
    <link rel="stylesheet" href="../css/element-ui.css"/>
    <script src="../js/axios.min.js"></script>
    <script src="../js/src-min-noconflict/ace.js"></script>
    <script src="../js/src-min-noconflict/ext-language_tools.js"></script>
    <style>
        .el-header {
            background-color: #455A64;
            color: white;
            text-align: center;
            line-height: 60px;
        }

        body {
            font-family: "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;

        }
    </style>
</head>
<body>
<div id="main">
    <el-container>
        <el-header>LiteEditor - UserInstance</el-header>
        <el-main>
            <el-card class="box-card">
                <el-row>
                    <p></p>
                    <p>实例辨识符 : <span v-text="insCODE"></span></p>
                    <textarea id="url" v-text="insURL" hidden></textarea>

                </el-row>
            </el-card>
            <br>
            <el-card class="box-card">
                <pre id="editor" style="min-height:400px"><textarea class="ace_text-input"  v-text="content"></textarea></pre>
            </el-card>

        </el-main>
    </el-container>
</div>
</body>
<script>

    // 0408:Egg: 统一获取hostname 而不是在 Handmade 啦 如果是 https 手动改改
    var full_adress = "http://" + document.location.hostname + ":1901";

    // Default HTML Content
    var defaultContent = "<!DOCTYPE html>\n" +
        "<head>\n" +
        "    <meta charset=\"UTF-8\">\n" +
        "    <title>Exercise Page</title>\n" +
        "</head>\n" +
        "<body>\n" +
        "    \n" +
        "</body>\n" +
        "</html>";

    const vm = new Vue({
        el: '#main',
        data: {
            insID: GetQueryValue('id'),
            insCODE: GetQueryValue('code'),
            insURL: "",
            content: defaultContent,
        },
        methods: {}
    });

    function GetQueryValue(queryName) {
        var query = decodeURI(window.location.search.substring(1));
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == queryName) {
                return pair[1];
            }
        }
        return null;
    }

    // Settings for Ace Editor
    ace.require("ace/ext/language_tools");
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    // On update when changed
    editor.session.on('change', () => {
        let data = {"id": vm.insID, "code": vm.insCODE, "content": editor.getValue()};
        axios.post(full_adress + '/instance/updateContentByID', data)
            .then(function (response) {
                // Nothing to do
            })
            .catch(function (error) {
                console.log(error);
            });
    })
    editor.setOptions({
        enableBasicAutocompletion: true,
        enableSnippets: true,
        enableLiveAutocompletion: true
    });



</script>
</html>

